function JR(){this.__VERSION__='3.1';this.__WORKPATH__='';this.__Extend_PROTOTYPE__=true}JR.prototype={__init__:function(){if(this.__Extend_PROTOTYPE__){this.__extendingJsPrototype__()}var _scripts=document.getElementsByTagName('SCRIPT');var s=_scripts[_scripts.length-1];var _sloc=s.src;this.__WORKPATH__=_sloc.replace(/(\/)[^/]+$/,'$1');if(!document.getElementsByClassName){document.getElementsByClassName=function(className,ele){if(ele&&!ele.nodeName){ele=document.getElementById(ele)}var elem=(ele||document).getElementsByTagName('*');var reg=new RegExp('\\s'+className+'\\s');var arr=[];for(var i=0,j;j=elem[i];i++){if(reg.test(' '+j.className+' '))arr.push(j)}return arr}}if(typeof(HTMLElement)!="undefined"){HTMLElement.prototype.contains=function(obj){while(obj!=null&&typeof(obj.tagName)!="undefind"){if(obj==this)return true;obj=obj.parentNode}return false}}if(!window.toJson){window.toJson=function(s){if(!s)return null;if(window.JSON){try{return JSON.parse(s)}catch(ex){}}return eval('('+s+')')}}return this},__extendingJsPrototype__:function(){String.prototype.len=function(zh){return this.replace(zh?/[\u0391-\uFFE5]/g:/[^x00-xff]/g,"00").length};Date.prototype.format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};var week={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"/u661f/u671f":"/u5468"):"")+week[this.getDay()+""])}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))}}return fmt}},extend:function(prop){if(prop&&prop instanceof Object){for(var ext in prop){if(this[ext]==undefined){this[ext]=prop[ext]}}}return this},dom:{fitHeight:function(e,offset){var par=e.parentNode;var next=e.nextSibling;var reg=/;(\s*)height:(.+);/ig;var height=(par==document.body?Math.max(document.body.clientHeight,document.documentElement.clientHeight):par.offsetHeight)-e.offsetTop;while(next){if(next.nodeName[0]!='#'){height-=next.offsetHeight}next=next.nextSibling}height-=offset||0;if(reg.test(e.style.cssText)){e.style.cssText=e.style.cssText.replace(reg,'; height:'+height+'px;')}else{e.style.cssText+='height:'+height+'px;'}},$:function(el,tagName,attrs){var e=el.nodeName?el:document.getElementById(el||'');if(!e)throw el.nodeName?'object refrence null':'element '+el+' not exits!';if(!tagName)return e;e=e.getElementsByTagName(tagName);if(!attrs)return e;var arr=[];var attr_name;for(var i=0;i<e.length;i++){var equalAttr=true;for(var j in attrs){switch(j){case"className":attr_name=e[i].getAttribute("class")?"class":"className";break;default:attr_name=j;break}if(e[i].getAttribute(attr_name)!=attrs[j])equalAttr=false;if(equalAttr)arr.push(e[i])}}return arr},getsByClass:function(ele,className){ele=ele||document;return ele.getElementsByClassName?ele.getElementsByClassName(className):document.getElementsByClassName(className,ele)}},$:function(el,tagName,attrs){return this.dom.$(el,tagName,attrs)},each:function(arr,call){if(arr){for(var i=0;i<arr.length;i++)call(i,arr[i])}},style:function(id,attr){var e=e||this.dom.$(id);if(!e)return null;if(attr){if(attr instanceof Object){for(var s in attr){var cssAttr=s.split("-");for(var i=1;i<cssAttr.length;i++){cssAttr[i]=cssAttr[i].replace(cssAttr[i].charAt(0),cssAttr[i].charAt(0).toUpperCase())}var newCssAttr=cssAttr.join('');e.style[newCssAttr]=attr[s]}}else if(attr instanceof String){e.style.cssText=attr}}return e.currentStyle||document.defaultView.getComputedStyle(e,null)},request:function(id,url){var match=new RegExp('(\\?|&)'+id+'=([^&]+)&*').exec(url?url:location.href);return match?match[2]:''},supportHTML5:navigator.geolocation!=null,template:function(content,data){if(data instanceof Object){var reg=new RegExp();for(var n in data){reg.compile('%'+n+'%|\{'+n+'\}','g');content=content.replace(reg,data[n])}}return content},screen:{width:function(){return Math.max(document.body.clientWidth,document.documentElement.clientWidth)},height:function(){return Math.max(document.body.clientHeight,document.documentElement.clientHeight)},offsetWidth:function(){return Math.max(document.body.offsetWidth,document.documentElement.offsetWidth)},offsetHeight:function(){return Math.max(document.body.offsetHeight,document.documentElement.offsetHeight)}},event:{add:function(elem,event,func,b){if(!elem.attachEvent&&!elem.addEventListener){alert('event error! parameter:'+ele+',event:'+event);return}document.attachEvent?elem.attachEvent('on'+event,func):elem.addEventListener(event,func,b)},remove:function(elem,event,func,b){document.detachEvent?elem.detachEvent('on'+event,func):elem.removeEventListener(event,func,b)},src:function(event){var e=event?event:window.event;return e.target||e.srcElement},stopBubble:function(event){var e=event?event:window.event;if(window.event){e.cancelBubble=true}else{e.stopPropagation()}},preventDefault:function(event){if(window.event){window.event.returnvalue=false;return false}else{event.preventDefault();return false}}},xhr:{maxRequest:4,filter:function(status, method, content){if(status==2){var matches=/<title>(.+)<\/title>/.exec(content);if(matches&&matches.length>0){alert(matches[1]);return false}}return true},httpStack:null,procStack:[],init:function(){if(this.httpStack)return;this.httpStack=[];for(var i=0; i<this.maxRequest; i++){this.httpStack[i]={state:0,http:window.XMLHttpRequest?new XMLHttpRequest():(new ActiveXObject("MSXML2.XMLHTTP")||new ActiveXObject("MICROSOFT.XMLHTTP"))}}},getUrl:function(url, reqMethod, getRandom){if(url==null||url==''){url=location.href}if(reqMethod=='POST'&&url.indexOf('jr-xhr')==-1){url+=(url.indexOf('?')==-1?'?':'&')+'jr-xhr=1'}else if(reqMethod=='GET'){getRandom=getRandom==false?false:getRandom||true;if(getRandom&&url.indexOf('#')==-1){if(url.indexOf("?")==-1)url+="?t="+Math.random();else url+="&t="+Math.random()}}return url},request:function(_request, call){this.init();var reqMethod=(_request.method||"GET").toUpperCase();if(this.filter&&!this.filter(0,reqMethod)){return false}var reqArgs={uri:this.getUrl(_request.uri,reqMethod,_request.random),params:_request.params||'',method:reqMethod,async:_request.async===false?false:_request.async||true,data:(_request.data||'text').toLowerCase(),call:call};if(_request.params instanceof Object){var tmpInt=0;reqArgs.params='';for(var i in _request.params){if(tmpInt++!==0){reqArgs.params+='&'}reqArgs.params+=i+'='+encodeURIComponent(_request.params[i])}}var xhrProc=function(_xhr, _xhrobj, _request){_xhr.state=1;_xhr.http.open(_request.method,_request.uri,_request.async);_xhr.http.onreadystatechange=function(){if(_xhr.http.readyState===4){if(_xhr.http.status===200){_xhr.state=0;_xhrobj.procStack.pop();if(_xhrobj.filter&&!_xhrobj.filter(1,_request.method,_xhr.http.responseText)){return false}if(_request.call.success){_request.call.success(_request.data==="text"?_xhr.http.responseText:(_request.data==='json'?window.toJson(_xhr.http.responseText):_xhr.http.responseXML))}}else if(_request.call.error){_xhr.state=0;_xhrobj.procStack.pop();if(_xhrobj.filter&&!_xhrobj.filter(2,_request.method,_xhr.http.responseText)){return false}_request.call.error(_xhr.http.responseText)}};return true};if(_request.method==="POST")_xhr.http.setRequestHeader("Content-Type","application/x-www-form-urlencoded");_xhr.http.send(_request.params)};(function(t, req){var timer=setInterval(function(){if(t.procStack.length<t.maxRequest){t.procStack.push(0);for(var i=0; i<t.maxRequest; i++){if(t.httpStack[i].state===0){try{xhrProc(t.httpStack[i],t,req)}catch(exc){if(req.call.error)req.call.error('request may be blocked!');console.log(exc)}break}}clearInterval(timer)}},20)}(this,reqArgs))},get:function(param, callback, errorFunc){this.request(param instanceof Object?this.getUrl(param):{uri:param},{success:function(x){if(callback)callback(x)},error:function(x){if(errorFunc)errorFunc(x)}})},post:function(uri, param, okCall, errCall){this.request({uri:uri,method:'POST',params:param},{success:function(x){if(okCall)okCall(x)},error:function(x){if(errCall)errCall(x)}})},jsonPost:function(uri, param, success, error){this.request({uri:uri,params:param,method:'POST',data:'json'},{success:function(json){if(success)success(json)},error:function(result){if(error)error(result)}})}},cookie:{write:function(name,value,seconds){var expire="";if(seconds){expire=new Date((new Date()).getTime()+seconds);expire="; expires="+expire.toGMTString()}document.cookie=name+"="+escape(value)+expire},remove:function(name){this.write(name,"",-9)},read:function(name){var cookieValue="";var search=name+"=";if(document.cookie.length>0){var offset=document.cookie.indexOf(search);if(offset!==-1){offset+=search.length;var end=document.cookie.indexOf(";",offset);if(end===-1)end=document.cookie.length;cookieValue=unescape(document.cookie.substring(offset,end))}}return cookieValue}},getPosition:function(e){return(e.nodeName?e:this.$(e)).getBoundingClientRect()},loadHTML:function(panel,html){var bodyReg=/<body[^>]*>([\s\S]+)<\/body>/im;var scriptReg=/<script((.|\n)*?)>([\s\S]*?)<\/script>/gim;var body=html.match(bodyReg);if(body==null){body=['',html]}if(!panel.nodeName)panel=this.dom.$(panel);if(panel){try{panel.innerHTML=body[1].replace(scriptReg,'').replace(/<style([^>]+)>/ig,'<span style="display:none" class=\"forie\">_</span><style$1>');this.each(panel.getElementsByClassName?panel.getElementsByClassName('forie'):document.getElementsByClassName('forie',panel),function(i,e){panel.removeChild(e)});if(window.navigator.userAgent.indexOf('Chrome')!=-1){this.each(panel.getElementsByTagName('STYLE'),function(i,e){panel.removeChild(e);document.getElementsByTagName('HEAD')[0].appendChild(e)})}}catch(ex){if(window.console){console.log(ex.message)}}}var spaceReg=/^[\n\s]+$/g;var regType=/type=["']*text\/javascript["']*/i;var jsSection;scriptReg.lastIndex=0;while((jsSection=scriptReg.exec(html))!=null){if(jsSection[1].indexOf(' type=')==-1||regType.test(jsSection[1])){if(!spaceReg.test(jsSection[3])){this.eval(jsSection[3])}}}},load:function(panel,url,success,error){(function(_this){_this.xhr.get(url,function(result){_this.loadHTML(panel,result);if(success){success(result)}},error)}(this))},ld:function(libName,path){(function(j,_path){j.xhr.get({uri:_path+libName+'.js',async:false,random:false},function(script){j.eval(script)})}(this,path||this.__WORKPATH__))},toJson:function(str){return window.toJson(str)},eval:function(code){if(!code)return code;if(window.execScript){window.execScript(code)}else{var script=document.createElement('SCRIPT');script.setAttribute('type','text/javascript');script.text=code;document.head.appendChild(script);document.head.removeChild(script)}return code}};JR.prototype.plugin=JR.prototype.extend;JR.prototype.ie6=function(){return/MSIE\s*6\.0/.test(window.navigator.userAgent)};JR.prototype.path=function(){var d=document.domain,uri=location.href;d=uri.substring(uri.indexOf(d)+d.length);return d.substring(d.indexOf("/"))};JR.prototype.val=function(id,val){if(!val)return document.getElementById(id).value;else document.getElementById(id).value=val};JR.prototype.lazyRun=function(func,timer){if(func){setTimeout(func,timer||120)}};JR.prototype.hover=function(e,hoverFunc,leaveFunc){if(!e.nodeName)e=this.$(e);var isIE6=this.ie6();this.event.add(e,'mouseover',(function(t){return function(){if(isIE6)t.className+=' hover';if(hoverFunc)hoverFunc(t)}})(e));this.event.add(e,'mouseout',(function(t){return function(){if(isIE6)t.className=t.className.replace(' hover','');if(leaveFunc)leaveFunc(t)}})(e))};JR.prototype.ldScript=function(scriptUrl,loadfunc,errorfunc){var scriptPanel=null;var heads=document.documentElement.getElementsByTagName("HEAD");if(heads.length!=0)scriptPanel=heads[0];else scriptPanel=document.body;var scripts=scriptPanel.getElementsByTagName('SCRIPT');var hasLoaded=false;for(var i=0;i<scripts.length;i++){if(scripts[i].getAttribute('src')&&scripts[i].getAttribute('src').toLowerCase()==scriptUrl.toLowerCase()){hasLoaded=true}}if(!hasLoaded){var script=document.createElement('SCRIPT');if(loadfunc)script.onreadystatechange=script.onload=loadfunc;if(errorfunc)script.onerror=errorfunc;script.setAttribute('type','text/javascript');script.setAttribute('src',scriptUrl);scriptPanel.appendChild(script)}};JR.prototype._width=function(e,client){e=this.$(e);var s=this.style(e);if(s["display"]!='none'){return client?e.clientWidth:e.offsetWidth}var cls={};for(var i in s){cls[i]=s[i]}this.style(e,{position:'absolute',visibility:'hidden',display:'block'});var w=client?e.clientWidth:e.offsetWidth;this.style(e,cls);this.style(e,{display:'none'});return w};JR.prototype._height=function(e,client){e=this.$(e);var s=this.style(e);if(s["display"]!='none'){return client?e.clientHeight:e.offsetHeight}var cls={};for(var i in s){cls[i]=s[i]}this.style(e,{position:'absolute',visibility:'hidden',display:'block'});var h=client?e.clientHeight:e.offsetHeight;cls.display='none';this.style(e,cls);this.style(e,{display:'none'});return h};JR.prototype.width=function(e){return this._width(e)};JR.prototype.height=function(e){return this._height(e)};JR.prototype.clientWidth=function(e){return this._width(e,true)};JR.prototype.clientHeight=function(e){return this._height(e,true)};window.jr=new JR().__init__();(function(r){if(r)r(function(){return jr})})(window.define);


jr.extend({ json: { prefix: 'field', _objReg: /(.+)\[([^\]]+)\]/, _dtReg: /^(\d{4}((\/|-)\d{2}){2})T(\d{2}(:\d{2}){2})((\.\d+)*)$/i, _each: function (a, b) { for (var i = 0; i < a.length; i++) { if (b) b(i, a[i]) } }, _getFields: function (b) { var c = this.prefix; var d = {}; var f; var g, subProName, proValue; if (!b.nodeName) b = document.getElementById(b); var h = this._objReg; this._each(b.getElementsByTagName('*'), function (i, e) { if (e.nodeName != '#text' && e.nodeName != '#comment') { g = e.getAttribute(c); if (g) { if (h.test(g)) { var a = h.exec(g); g = a[1]; subProName = a[2]; if (d[g] == null) { d[g] = {} } d[g][subProName] = e } else { d[g] = e } if (!e.name) e.setAttribute('name', c + '_' + g) } } }); return d }, _bindField: function (a, b) { if (this._dtReg.test(b)) { var c = this._dtReg.exec(b); if (c[4] == '00:00:00') { b = b.replace(this._dtReg, '$1') } else { b = b.replace(this._dtReg, '$1 $4') } } switch (a.nodeName) { case 'TEXTAREA': case 'INPUT': switch (a.type) { default: a.value = b; break; case "radio": var d = document.getElementsByName(a.name); for (var i = 0; i < d.length; i++) { if (d[i].value == b) { d[i].setAttribute('checked', 'checked'); break } } break; case 'checkbox': var e = false; if ((b == true && b.toString() != '1') || b == a.value) { e = true } else if (b.length) { for (var i in b) { if (b[i] == a.value) { e = true; break } } } if (e) { a.setAttribute('checked', 'checked') } else { a.removeAttribute('checked') } break } break; case 'IMG': a.src = b; break; case 'SELECT': a.value = b; break; default: a.innerHTML = b; break } }, _getFieldVal: function (a) { var b = ''; switch (a.nodeName) { case 'TEXTAREA': case 'INPUT': switch (a.type) { default: b = a.value; break; case 'radio': var c = document.getElementsByName(a.name); for (var i = 0; i < c.length; i++) { if (c[i].checked) { b = c[i].value; break } } break; case 'checkbox': b = a.checked ? a.value : ''; break } break; case 'IMG': b = a.src; break; case 'SELECT': b = a.selectedIndex == -1 ? '' : a.options[a.selectedIndex].value; break; default: b = a.innerHTML; break } return b }, bind: function (a, b, c) { var d; var e; var f; d = this._getFields(a); for (var g in d) { e = d[g]; if (c && c instanceof Function) { f = c(g, b[g]) } else { f = b[g] } if (f != null) { if (f instanceof Object) { if (f.length) { for (var i in e) { this._bindField(e[i], f) } } else { for (var i in f) { if (e[i]) { this._bindField(e[i], f[i]) } } } continue } this._bindField(e, f) } } }, __convert: function (a, b, c) { var d; var e; var f; var g = {}; var h = ''; d = this._getFields(a); for (var k in d) { e = d[k]; if (e.nodeName) { f = this._getFieldVal(e); if (c && c instanceof Function) { f = c(k, f) } g[k] = f; h += k + '=' + f + '&' } else { g[k] = {}; var j = 0; var l = false; for (var i in e) { if (j++ == 0 && /^\d+$/.test(i)) { g[k] = []; l = true } if (e[i]) { f = this._getFieldVal(e[i]); if (c && c instanceof Function) { f = c(k, f) } if (f && f != '') { if (l) { g[k].push(f) } else { g[k][i] = f } } h += k + '[' + i + ']=' + f + '&' } } } } return b == "object" ? g : h.replace(/&$/g, '') }, toObject: function (a) { return this.__convert(a, 'object') }, toQueryString: function (a) { return this.__convert(a, 'string') }, toString: function (a) { return this.__convert(a, 'string').replace(/&/g, ';').replace(/=/g, ':') }, string: function (o) { var a = this; var b = []; var c = function (s) { if (typeof s == 'object' && s != null) a.string(s); return /^(string|number)$/.test(typeof s) ? "'" + s + "'" : s }; for (var i in o) { if (o.hasOwnProperty(i)) { var d = c(o[i]); if (d.pop) { b.push("'" + i + "':[\'" + escape(d.join('\',\'')) + '\']') } else { b.push("'" + i + "':" + escape(d)) } } } return '{' + escape(b.join(',')) + '}' } } });
jr.extend({ form: { getData: function (a) { var b = ''; var c = document.forms[a || 0]; return jr.json.toQueryString(c) }, asyncSubmit: function (a, b) { var c = document.forms[a || 0]; var d = document.getElementById('$async_ifr'); if (!d) { try { d = document.createElement('<iframe name="$async_ifr">') } catch (ex) { d = document.createElement('iframe'); d.setAttribute('name', '$async_ifr') } d.setAttribute('id', '$async_ifr'); if (!b) { d.style.cssText = 'display:none' } else { d.style.cssText = 'width:600px;height:400px' } document.body.insertBefore(d, document.body.firstChild) } if (c.getAttribute('target') != d.name) { c.setAttribute('target', d.getAttribute('name')) } c.submit() } } });
jr.extend({ validator: { setTip: function (e, a, b, c) { if (b) { var d = e.getAttribute('summary'); if (d) { d = jr.toJson(d); if (d[b]) { c = d[b] } } } if (e.getAttribute('tipin')) { var f = document.getElementById(e.getAttribute('tipin')); if (f) { if (f.className.indexOf('validator') == -1) { f.className += ' validator' } f.innerHTML = '<span class="' + (a ? 'valid-right' : 'valid-error') + '"><span class="msg">' + c + '</span></span>'; return false } } var g = e.getAttribute('validate_id'); var h = document.getElementById(g); if (!h) { h = document.createElement('DIV'); h.id = g; h.className = 'validator'; var i = jr.getPosition(e); h.style.cssText = 'position:absolute;left:' + (i.right + document.documentElement.scrollLeft) + 'px;top:' + (i.top + document.documentElement.scrollTop) + 'px'; document.body.appendChild(h) } h.innerHTML = '<span class="' + (a ? 'valid-right' : 'valid-error') + '"><span class="msg">' + c + '</span></span>' }, removeTip: function (e) { if (e.getAttribute('tipin')) { var a = document.getElementById(e.getAttribute('tipin')); if (a) { a.innerHTML = ''; return false } } var b = document.getElementById(e.getAttribute('validate_id')); if (b) { document.body.removeChild(b) } }, result: function (a) { if (a) { var b = true; var c = document.getElementById(a); jr.each(jr.dom.getsByClass(c, 'ui-validate'), function (i, e) { if (b) { if (e.getAttribute('tipin')) { if (jr.$(e.getAttribute('tipin')).innerHTML.indexOf('valid-error') != -1) { b = false } } else { e = document.getElementById(e.getAttribute('validate_id')); if (jr.dom.getsByClass(e, 'valid-error').length != 0) { b = false } } } }); return b } else { return jr.dom.getsByClass(document, 'valid-error').length == 0 } }, init: function () { var f = jr; if (!f) { alert('未引用核心库!'); return false } var g = document.getElementsByClassName('ui-validate'); var h; for (var i = 0; i < g.length; i++) { h = g[i].getAttribute('validate_id'); while (h == null) { h = g[i].id; if (h && h != '') { h = 'validate_item_' + h } else { h = 'validate_item_' + parseInt(Math.random() * 1000).toString() } if (document.getElementById(h) != null) { h = null } else { g[i].setAttribute('validate_id', h) } } var j = new Array(); if (g[i].onblur) { j[j.length] = g[i].onblur } if (g[i].getAttribute('isnumber') == 'true') { g[i].style.cssText += 'ime-mode:disabled'; var k = (function (a, e) { return function () { if (/\D/.test(e.value)) { e.value = e.value.replace(/\D/g, '') } e.value = e.value.replace(/^0([0-9])/, '$1') } })(this, g[i]); jr.event.add(g[i], 'keyup', k); jr.event.add(g[i], 'change', k) } if (g[i].getAttribute('regex')) { var k = (function (b, e) { return function () { var a = new RegExp(); a.compile(e.getAttribute('regex')); if (!a.test(e.value)) { b.setTip(e, false, 'regex', '输入不正确') } else { b.removeTip(e) } } })(this, g[i]); j[j.length] = k } else { if (g[i].getAttribute('isrequired') == 'true' || g[i].getAttribute('required') == 'true') { var k = (function (a, e) { return function () { if (e.value.replace(/\s/g, '') == '') { a.setTip(e, false, 'required', '该项不能为空') } else { a.removeTip(e) } } })(this, g[i]); j[j.length] = k } if (g[i].getAttribute('length')) { var k = (function (d, e) { return function () { var a = e.getAttribute('length'); var b = /\[(\d*),(\d*)\]/ig; var c = parseInt(a.replace(b, '$1')), l_e = parseInt(a.replace(b, '$2')); if (e.value.length < c) { d.setTip(e, false, 'length', l_e ? '长度必须为' + c + '-' + l_e + '位' : '长度必须大于' + (c - 1) + '位') } else if (e.value.length > l_e) { d.setTip(e, false, 'length', c ? '长度必须为' + c + '-' + l_e + '位' : '长度必须小于' + (l_e + 1) + '位') } else if (e.getAttribute('required') == null || e.value.length > 0) { d.removeTip(e) } } })(this, g[i]); j[j.length] = k } } var l = (function (a) { return function () { for (var i = 0; i < a.length; i++) { if (a[i]) { a[i].apply(this, arguments) } } } })(j); g[i].onblur = l } }, validate: function (a) { var b; if (a) { b = jr.dom.getsByClass(document.getElementById(a), 'ui-validate') } else { b = jr.dom.getsByClass(document, 'ui-validate') } var c = function (e) { return e.getAttribute('required') == "true" || e.getAttribute('isrequired') == "true" || e.getAttribute('length') || e.getAttribute('regex') }; for (var i = 0; i < b.length; i++) { if (c(b[i])) { if (b[i].onblur) { b[i].onblur() } } } return this.result(a) } } }); jr.event.add(window, 'load', function () { jr.validator.init() });


var DialogText={ALERT_MSG_TPL:'<div class="ui-alert-message">'+'<span class="alert-icon alert-icon-{icon}"></span>{msg}</div>',ALERT_BTN_TPL:'<input type="button" tag="{tag}" value="{text}"/>',ALERT_ALL_TITLE:'提示',ALERT_BTN_OK_TEXT:'确定',ALERT_BTN_CANCEL_TEXT:'取消'};function simpleDialog(a){this.window=window;this.opts={_inited:false,id:parseInt(Math.random()*1000+(new Date()).valueOf()%1000),title:'',drag:!false,className:'ui-dialog',setupFade:false,canNotClose:false,onclose:null,cross:!false,textArr:DialogText,};this.eles={panel:null,con:null,box:null,};this.win=window;this.doc=null;for(var i in a){if(a[i]){this.opts[i]=a[i]}}if(this.opts.cross!=false){while(this.win.parent!=this.win){this.win=this.win.parent}}this.doc=this.win.document}simpleDialog.prototype={new:function(a,b){var e=document.createElement(a);for(i in b){e.setAttribute(i,b[i])}return e},_initialize:function(){with(this.opts){if(_inited){return false}var a=this.doc;var b='position:fixed;top:0;left:0;bottom:0;right:0;margin:auto';this.eles.panel=this.new('DIV',{id:'panel_'+id,class:className});a.body.appendChild(this.eles.panel);this.eles.panel.appendChild(this.new('DIV',{class:'bg bglayer',style:'z-index:99;'+b}));css='z-index:100;'+b;this.eles.box=this.new('DIV',{class:'box',style:css});this.eles.panel.appendChild(this.eles.box);if(title){var c='<span class="left corner" style="position:absolute;left:0;top:0">&nbsp;</span><span class="txt">'+title+'</span>';if(!canNotClose){c+='<span class="close" style="position:absolute;right:5px;top:0;">'+'<i class="fa fa-times" aria-hidden="true"></i></span>'}c+='<span class="right corner" style="position:absolute;right:0;top:0">&nbsp;</span>';var e=this.new('DIV',{class:'title',style:'user-select:none;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none;'});e.innerHTML=c;this.eles.box.appendChild(e);e.getElementsByTagName('SPAN')[2].onclick=(function(d){return function(){d.close()}})(this);this.win['dialog_'+this.id]=this;if(drag){new dragObject(e,this.win).start(this.eles.box)}}this.eles.con=this.new('DIV',{class:'content con'});this.eles.box.appendChild(this.eles.con);if(title){var f=a.createElement("div");f.className='bottom';f.style.cssText="position:relative;";f.innerHTML='<span class="left corner" style="position:absolute;left:0;">&nbsp;</span><span class="txt">&nbsp;</span><span class="right corner" style="position:absolute;right:0;">&nbsp;</span>';this.eles.box.appendChild(f)}_inited=true}},getPanel:function(){return this.eles.panel},hiddenBox:function(){with(this.eles.box){style.visibility='hidden';style.left='inherit';style.bottom='inherit'}},showBox:function(){with(this.eles.box){style.visibility='';style.width=offsetWidth+'px';style.height=offsetHeight+'px';style.left='0';style.bottom='0'}},getFrameWindow:function(){var a=this.eles.panel.getElementsByTagName('IFRAME');if(a.length>0){return a[0].contentWindow}return null},getTargetWindow:function(){return this.win},open:function(a, b, c, d){this._initialize();this.hiddenBox();var e=this.eles.con;this.eles.con.innerHTML+="<iframe frameborder='0' scrolling='"+(d||'auto')+"' src='"+a+"' width='"+(b||'100%')+"' style='padding:0' height='"+(c||'100%')+"'></iframe>";e.style.width=Math.max(e.scrollWidth,b)+'px';e.style.height=Math.max(e.scrollHeight,c)+'px';this.showBox()},write:function(a){this._initialize();this.hiddenBox();var b=this.eles.con;if(!this.opts.title){b.innerHTML=a}else{var c=b.getElementsByTagName('DIV');for(var i=1;i<c.length;i++){b.removeChild(c[i])}b.innerHTML+=a}this.showBox()},async:function(a,b,c,d){return this.load(a,b,c,d)},load:function(a,b,c,e){this._initialize();this.hiddenBox();var f=jr.xhr;var g=(function(d){return function(x){jr.loadHTML(d.eles.con,x);d.showBox();if(e)e(x)}})(this);if(!b||b.toLowerCase()=="get"){f.get(a,g)}else{f.post(a,c,g)}},custom:function(p){var d=this;d.write(jr.template(this.opts.textArr.ALERT_MSG_TPL,{msg:p.message,icon:p.icon}));var b='';for(var i=0; i<p.buttons.length; i++){var e=p.buttons[i];if(e&&e.tag){b+=jr.template(this.opts.textArr.ALERT_BTN_TPL,{tag:e.tag,text:e.text})}}var c=Math.floor(Math.random()*10000);d.write('<div class="ui-alert-control" id="ui-alert-control-'+c+'">'+b+'</div>');var f=d.getTargetWindow().document.getElementById('ui-alert-control-'+c);var g=f.getElementsByTagName('INPUT');for(var i=0; i<g.length; i++){if(i===0){g[i].focus()}g[i].onclick=(function(d, p){return function(){var a=this.getAttribute('tag');if(p.click&&p.click instanceof Function){if(p.click(a,d)){d.close()}}else{d.close()}}})(d,p)}return d},closeDialog:function(){this.win.document.body.removeChild(this.eles.panel)},close:function(a){if(this.opts.onclose!=null&&this.opts.onclose()==false){return false}this.closeDialog();if(a)a();try{delete this.win['dialog_'+this.id]}catch(ex){this.win['dialog_'+this.id]=null}this.opts._inited=false}};function dragObject(a,b){this.elem=a;this.win=b}dragObject.prototype.regist=function(a,b,c,d){var o=this.elem;a=a?a:o;var f,sy;var g=this.win==null?g:this.win.document;o.style.cursor=b||"move";var h=c||function(e){e=e||event;window.getSelection?window.getSelection().removeAllRanges():g.selection.empty();if(e.preventDefault)e.preventDefault();with(a.style){position="absolute";margin='inherit';left=e.clientX-f+"px";top=e.clientY-sy+"px"}};jr.event.add(o,"mousedown",function(e){e=e||event;if(e.button==1||e.button==0){f=e.clientX-a.offsetLeft;sy=e.clientY-a.offsetTop;jr.event.add(g,'mousemove',h,false);jr.event.add(g,'mouseup',i,false)}},false);var i=function(){jr.event.remove(g,'mousemove',h,false);jr.event.remove(g,'mouseup',i,false);if(d&&d instanceof Function)d()}};dragObject.prototype.custom=function(a,b,c,d){return this.regist(a,b,c,d)};dragObject.prototype.start=function(a){this.regist(a,null,null,null)};var SimpleDialog={create:function(a){return new simpleDialog(a)},create2:function(a,b,c,d,e){return new simpleDialog({title:a,drag:b||false,cross:c||false,style:e,onclose:d})},getDialog:function(){var b=null;var c=/^dialog_/i;var e=window;var f=function(a){var d=null;for(var i in a){if(c.test(i)&&a[i]!=null){d=a[i];break}}return d};do{b=f(e);if(b==null){e=e.parent;b=f(e)}if(b){break}}while(e.parent!=e);return b},close:function(){var d=this.getDialog();if(d)d.close()},customAlert:function(p){var a=DialogText.ALERT_ALL_TITLE+'-'+(p.title||'');a=a.replace(/^-|-$/g,'');var d=this.create({title:a,drag:p.drag||true,cross:p.cross||true,canClose:false});return d.custom(p)},alert:function(a,b,c,d){return this.customAlert({icon:c,message:a,buttons:[{tag:'ok',text:d||DialogText.ALERT_BTN_OK_TEXT}],click:function(){if(b instanceof Function)b();return true}})},confirm:function(b,c,d){var e=DialogText.ALERT_BTN_OK_TEXT;var f=DialogText.ALERT_BTN_CANCEL_TEXT;if(d instanceof Array&&d.length===2){e=d[0];f=d[1]}return this.customAlert({icon:'confirm',message:b,buttons:[{tag:'ok',text:e},{tag:'cancel',text:f}],click:function(a){if(c instanceof Function){c(a!='cancel')}return true}})}};(function(r,j){var c={dialog:window.SimpleDialog,drag:function(a,b){return new drag(a,b)}};if(r&&j){r(['jr/core'],function(j){return j.extend(c)})}else{j.extend(c)}})(window.define,window.jr);



/***  AJAX ***/
function showMsg(msg, callback, second,notMask) {
    var win = window.parent || window;
    second = second || 2000;
    if (!win.xhrCt) {
        win.xhrCt = document.createElement("DIV");
        win.xhrCt.className = 'xhr-container hidden';
        win.xhrCt.innerHTML = jr.template('<div class="gate" style="width:100%;height:{h}px" id="xhr_gate_layout"></div><div class="msg" id="xhr_msg_layout"></div>', {
            h: jr.screen.height()
        });
        win.document.body.appendChild(win.xhrCt);
        win.xhrGate = win.document.getElementById('xhr_gate_layout');
        win.xhrMsg = win.document.getElementById('xhr_msg_layout');
    }

    var mw = msg.replace(/<[^>]+>/ig, '').length * 12 + 10;
    win.xhrMsg.innerHTML = msg;
    win.xhrMsg.style.width = mw + 'px';
    win.xhrGate.className = notMask ? "gate hidden" : 'gate';

    win.xhrCt.className = 'xhr-container';
    if (second) {
        setTimeout(function() {
            closeMsg();
            if (callback && callback instanceof Function)callback();
        }, second);
    }
}

function closeMsg() {
    var win = window.parent || window;
    win.xhrCt.className = 'xhr-container hidden';
}

function showErr(msg, second) {
    showMsg('<span class="error">' + msg + '</span>',null,second || 3000,true);
}
function showMsg2(msg,callback,second) {
    showMsg(msg, callback,second || 2000);
}

jr.xhr.filter = function (s, method, c) {
    if (s === 2) {
        var matches = /<title>(.+)<\/title>/.exec(c);
        if (matches && matches.length > 0) {
            jr.dialog.alert(matches[1]);
            return false;
        }
    }
    return true;
};
