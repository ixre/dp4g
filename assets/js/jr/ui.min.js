//function datagrid(h, k) { this.panel = h.nodeName ? h : jr.$(h); this.columns = k.columns; this.idField = k.idField || "id"; this.data_url = k.url; this.data = k.data; this.onLoaded = k.loaded; this.loadbox = null; this.gridView = null; this.loading = function () { if (this.gridView.offsetHeight == 0) { var a = this.gridView.previousSibling.offsetHeight; var b = this.panel.offsetHeight - this.gridView.previousSibling.offsetHeight; this.gridView.style.cssText = this.gridView.style.cssText.replace(/(\s*)height:[^;]+;/ig, ' height:' + (b > a ? b + 'px;' : 'auto')); var c = Math.ceil((this.gridView.clientWidth - this.loadbox.offsetWidth) / 2); var d = Math.ceil((this.gridView.clientHeight - this.loadbox.offsetHeight) / 2); this.loadbox.style.cssText = this.loadbox.style.cssText.replace(/(;\s*)*left:[^;]+;([\s\S]*)(\s)top:([^;]+)/ig, '$1left:' + c + 'px;$2 top:' + (d < 0 ? -d : d) + 'px') } this.loadbox.style.display = '' }; this._initLayout = function () { var a = ''; if (this.columns && this.columns.length != 0) { a += '<div class="ui-datagrid-header"><table width="100%" cellspacing="0" cellpadding="0"><tr>'; for (var i in this.columns) { a += '<td' + (i == 0 ? ' class="first"' : '') + (this.columns[i].align ? ' align="' + this.columns[i].align + '"' : '') + (this.columns[i].width ? ' width="' + this.columns[i].width + '"' : '') + '><span class="ui-datagrid-header-title">' + this.columns[i].title + '</span></td>' } a += '</tr></table></div>'; a += '<div class="ui-datagrid-view" style="position:relative;overflow:auto;height:0;">' + '<div class="loading" style="position: absolute; display: inline-block; left:0; top:0;">加载中...</div>' + '<div class="view"></div>' + '</div>' } this.panel.innerHTML = a; this.gridView = (this.panel.getElementsByClassName ? this.panel.getElementsByClassName('ui-datagrid-view') : jr.dom.getsByClass(this.panel, 'ui-datagrid-view'))[0]; this.loadbox = this.gridView.getElementsByTagName('DIV')[0] }; this._resize = function () { jr.dom.fitHeight(this.panel) }; this._fill_data = function (a) { if (!a) return; var b; var c; var d; var e = ''; var f = a['rows'] || a; e += '<table width="100%" cellspacing="0" cellpadding="0">'; for (var i = 0; i < f.length; i++) { b = f[i]; e += '<tr' + (b[this.idField] ? ' data-indent="' + b[this.idField] + '"' : '') + '>'; for (var j in this.columns) { c = this.columns[j]; d = b[c.field]; e += '<td' + (j == 0 ? ' class="first"' : '') + (i == 0 && c.width ? ' width="' + c.width + '"' : '') + (c.align ? ' align="' + c.align + '"' : '') + '>' + (c.formatter && c.formatter instanceof Function ? c.formatter(d, b, i) : d) + '</td>' } e += '</tr>' } e += '</table><div style="clear:both"></div>'; var g = this.gridView.getElementsByTagName('DIV')[1]; g.innerHTML = e; g.srcollTop = 0; this.loadbox.style.display = 'none'; if (this.onLoaded && this.onLoaded instanceof Function) this.onLoaded(a) }; this._load_data = function (b) { if (!this.data_url) return; var t = this; if (b) { if (!(b instanceof Function)) { b = null } } jr.xhr.request({ uri: this.data_url, data: 'json', params: this.data, method: 'POST' }, { success: function (a) { t._fill_data(a) }, error: function () { } }) }; this._initLayout(); this.load() } datagrid.prototype.resize = function () { this._resize() }; datagrid.prototype.load = function (a) { this.loading(); if (a && a instanceof Object) { this._fill_data(a); return } this._load_data() }; datagrid.prototype.reload = function (a, b) { if (a) { this.data = a } this.load(b) }; jr.extend({ grid: function (a, b) { return new datagrid(a, b) }, datagrid: function (a, b) { return new datagrid(a, b) } });
jr.extend({ table: { dynamic: function (f, g, h) { if (f && f.nodeName === "TABLE") { f.className += ' ui-table'; var j = f.getElementsByTagName('TH'); window.jr.each(j, function (i, e) { if (i != j.length - 1) { if ((e.getElementsByClassName ? e.getElementsByClassName('th-split') : document.getElementsByClassName('th-split', e)).length == 0) { var a = document.createElement("SPAN"); a.className = 'th-split'; e.appendChild(a) } } }); var k = f.getElementsByTagName("tr"); for (var i = 0; i < k.length; i++) { if (i % 2 == 1) if (!k[i].className) k[i].className = 'even'; k[i].onmouseover = function () { if (this.className.indexOf('selected') == -1) { this.className = this.className.indexOf('even') != -1 ? "hover even" : "hover" } }; k[i].onmouseout = function () { if (this.className.indexOf('selected') == -1) { this.className = this.className.indexOf("even") == -1 ? "" : "even" } }; k[i].onclick = (function (b, c, d) { return function () { var a = new Array(); window.jr.each(b, function (i, e) { if (!d) { if (e != c) { e.className = e.className.indexOf("even") == -1 ? "" : "even" } } if (e.className.indexOf('selected') != -1) { a.push(e) } }); if (c.className.indexOf('selected') == -1) { c.className = c.className.indexOf("even") == -1 ? "selected" : "selected even"; a.push(c) } if (h) { h(a) } } })(k, k[i], g) } } } } });
jr.extend({validator:{setTip:function(e,a,b,c){if(b){var d=e.getAttribute('summary');if(d){d=jr.toJson(d);if(d[b]){c=d[b]}}}if(e.getAttribute('tipin')){var f=document.getElementById(e.getAttribute('tipin'));if(f){if(f.className.indexOf('validator')==-1){f.className+=' validator'}f.innerHTML='<span class="'+(a?'valid-right':'valid-error')+'"><span class="msg">'+c+'</span></span>';return false}}var g=e.getAttribute('validate_id');var h=document.getElementById(g);if(!h){h=document.createElement('DIV');h.id=g;h.className='validator';var i=jr.getPosition(e);h.style.cssText='position:fixed;left:'+(i.right+document.documentElement.scrollLeft)+'px;top:'+(i.top+document.documentElement.scrollTop)+'px';document.body.appendChild(h)}h.innerHTML='<span class="'+(a?'valid-right':'valid-error')+'"><span class="msg">'+c+'</span></span>'},removeTip:function(e){if(e.getAttribute('tipin')){var a=document.getElementById(e.getAttribute('tipin'));if(a){a.innerHTML='';return false}}var b=document.getElementById(e.getAttribute('validate_id'));if(b){document.body.removeChild(b)}},result:function(a){if(a){var b=true;var c=document.getElementById(a);jr.each(jr.dom.getsByClass(c,'ui-validate'),function(i,e){if(b){if(e.getAttribute('tipin')){if(jr.$(e.getAttribute('tipin')).innerHTML.indexOf('valid-error')!=-1){b=false}}else{e=document.getElementById(e.getAttribute('validate_id'));if(jr.dom.getsByClass(e,'valid-error').length!=0){b=false}}}});return b}else{return jr.dom.getsByClass(document,'valid-error').length==0}},init:function(){var f=jr;if(!f){alert('未引用核心库!');return false}var g=document.getElementsByClassName('ui-validate');var h;for(var i=0;i<g.length;i++){h=g[i].getAttribute('validate_id');while(h==null){h=g[i].id;if(h&&h!=''){h='validate_item_'+h}else{h='validate_item_'+parseInt(Math.random()*1000).toString()}if(document.getElementById(h)!=null){h=null}else{g[i].setAttribute('validate_id',h)}}var j=new Array();if(g[i].onblur){j[j.length]=g[i].onblur}if(g[i].getAttribute('isnumber')=='true'){g[i].style.cssText+='ime-mode:disabled';var k=(function(a,e){return function(){if(/\D/.test(e.value)){e.value=e.value.replace(/\D/g,'')}e.value=e.value.replace(/^0([0-9])/,'$1')}})(this,g[i]);jr.event.add(g[i],'keyup',k);jr.event.add(g[i],'change',k)}if(g[i].getAttribute('isfloat')=='true'){g[i].style.cssText+='ime-mode:disabled';var k=(function(a,e){return function(){if(/[^\d\.]/.test(e.value)){e.value=e.value.replace(/[^\d\.]/g,'')}e.value=e.value.replace(/^(0|\.)([0-9]+\.*[0-9]*)/,'$2')}})(this,g[i]);jr.event.add(g[i],'keyup',k);jr.event.add(g[i],'change',k)}if(g[i].getAttribute('regex')){var k=(function(b,e){return function(){var a=new RegExp();a.compile(e.getAttribute('regex'));if(!a.test(e.value)){b.setTip(e,false,'regex','输入不正确')}else{b.removeTip(e)}}})(this,g[i]);j[j.length]=k}else{if(g[i].getAttribute('isrequired')=='true'||g[i].getAttribute('required')=='true'){var k=(function(a,e){return function(){if(e.value.replace(/\s/g,'')==''){a.setTip(e,false,'required','该项不能为空')}else{a.removeTip(e)}}})(this,g[i]);j[j.length]=k}if(g[i].getAttribute('length')){var k=(function(d,e){return function(){var a=e.getAttribute('length');var b=/\[(\d*),(\d*)\]/ig;var c=parseInt(a.replace(b,'$1')),l_e=parseInt(a.replace(b,'$2'));if(e.value.length<c){d.setTip(e,false,'length',l_e?'长度必须为'+c+'-'+l_e+'位':'长度至少'+(c)+'位')}else if(e.value.length>l_e){d.setTip(e,false,'length',c?'长度必须为'+c+'-'+l_e+'位':'长度超出'+(l_e)+'位')}else if(e.getAttribute('required')==null||e.value.length>0){d.removeTip(e)}}})(this,g[i]);j[j.length]=k}}var l=(function(a){return function(){for(var i=0;i<a.length;i++){if(a[i]){a[i].apply(this,arguments)}}}})(j);g[i].onblur=l}},validate:function(a){var b;if(a){b=jr.dom.getsByClass(document.getElementById(a),'ui-validate')}else{b=jr.dom.getsByClass(document,'ui-validate')}var c=function(e){return e.getAttribute('required')=="true"||e.getAttribute('isrequired')=="true"||e.getAttribute('length')||e.getAttribute('regex')};for(var i=0;i<b.length;i++){if(c(b[i])){if(b[i].onblur){b[i].onblur()}}}return this.result(a)}}});jr.event.add(window,'load',function(){jr.validator.init()});
jr.extend({ animation: { timer: function (a, b, c, d, e) { if (!a) return; var f = c != null ? c : 0; var g = d != null ? d : 100; var h = 0; var i = 0; if (e < 1 || e > 5) { h = (d - c) < 0 ? -e : e; i = 20 } else { h = (g - f) / (4 * (6 - e)); h *= (Math.abs(g - f) / 100); i = 1000 / h; i = i < 0 ? -Math.ceil(i) : Math.floor(i); if (i < 30) i = 30 } var t = setInterval(function () { f = f + h; if (Math.abs(f) >= Math.abs(g)) { f = g; if (b instanceof Function) b(); clearInterval(t) } a(f, h) }, i) }, opacity: function (e, d, f, g) { var h = jr.$(e); var s = jr.style(h); var i = s["opacity"]; if (i == undefined) { if (h.filters.alpha) { i = h.filters.alpha.opacity / 100 } else { i = 0 } } this.timer((function (e) { return function (t, a) { var b = a < 0; var c = b ? (100 + t) / 100 : t / 100; e.style.opacity = c; e.style.filter = 'alpha(opacity=' + (c * 100) + ')'; if (t == -100 && b) { e.style.display = 'none' } else if (!b && t == a) { e.style.display = '' } } })(h), d, parseInt(i), f, g) }, fade: function (e, a, b) { var c = b != null ? b : 3; var d = -100; this.opacity(e, a, d, c) }, show: function (e, a, b) { var c = b != null ? b : 3; var d = 100; this.opacity(e, a, d, c) }, toggle: function (e, a, b) { this._toggle(e, 'wh', a, b) }, toggleWidth: function (e, a, b) { this._toggle(e, 'w', a, b) }, toggleHeight: function (e, a, b) { this._toggle(e, 'h', a, b) }, _toggle: function (e, a, b, c) { e = jr.$(e); var d = jr.style(e); var w = e.offsetWidth; var h = e.offsetHeight; var f = parseInt(e.getAttribute("toggle-w") || 0); var g = parseInt(e.getAttribute("toggle-h") || 0); if (f == 0 || g == 0) { if (w == 0 || h == 0) { w = f = jr.clientWidth(e); h = g = jr.clientHeight(e) } e.setAttribute('toggle-w', w); e.setAttribute('toggle-h', h) } var i = c == null ? 2 : c; var j = i * (g / f); if (d["display"] == 'none') { var k = { overflow: 'hidden', display: 'inherit' }; if (a.indexOf('w') != -1) { k.width = '0px' } if (a.indexOf('h') != -1) { k.height = '0px' } jr.style(e, k); this._toggleShow(e, a, b, w, f, h, g, i, j) } else { e.style.overflow = 'hidden'; this._toggleClose(e, a, b, w, f, h, g, i, j) } }, _toggleShow: function (e, b, c, w, d, h, f, g, i) { if (b.indexOf('w') != -1) { this.timer((function (e, w) { return function (t, a) { e.style.width = (a > 0 ? t : (w + t)) + 'px' } })(e, w), c, 0, d, g) } if (b.indexOf('h') != -1) { this.timer((function (e, h) { return function (t, a) { e.style.height = (a > 0 ? t : (h + t)) + 'px' } })(e, h), c, 0, f, i) } }, _toggleClose: function (e, c, d, w, f, h, f, g, i) { if (c.indexOf('w') != -1) { this.timer((function (e, w) { return function (t, a) { var b = (a > 0 ? t : (w + t)); if (b < 0) b = 0; e.style.width = b + 'px'; if (b == 0) { e.style.display = 'none' } } })(e, w), d, 0, -w, g) } if (c.indexOf('h') != -1) { this.timer((function (e, h) { return function (t, a) { var b = a > 0 ? t : h + t; if (b < 0) b = 0; e.style.height = b + 'px'; if (b == 0) { e.style.display = 'none' } } })(e, h), d, 0, -h, i) } } } });
function simpleDialog(e){this._simgpleDialog=true;this.window=window;this.win=window;this.doc=null;this.id=new Date().getMilliseconds()+parseInt(Math.random()*100);this.title=e.title;this.drag=e.drag;this.style=e.style||'ui-dialog';this.setupFade=!e.setupFade?e.setupFade:true;this.onclose=e.onclose;this.canNotClose=e.canClose==false;if(e.cross!=false){while(this.win.parent!=this.win){this.win=this.win.parent}}this.doc=this.win.document;this._inited=false;this.canvas={width:this.doc.documentElement.clientWidth,height:Math.min(this.doc.documentElement.clientHeight,this.doc.body.clientHeight),maxHeight:Math.max(this.doc.documentElement.clientHeight,this.doc.body.clientHeight)};this.point={x:parseInt((this.canvas.width)/2)+this.doc.documentElement.scrollLeft,y:parseInt((this.canvas.height)/2)+this.doc.documentElement.scrollTop};this.fixBoxPosition=function(a){var b=this.getPanel().getElementsByTagName('DIV')[1];if(!a){this.point.x=(this.canvas.width-b.offsetWidth)/2+document.documentElement.scrollLeft;this.point.y=(this.canvas.height-b.offsetHeight)/2+document.documentElement.scrollTop;b.style.left=this.point.x+'px';b.style.top=this.point.y+'px';if(this.title&&this.drag){new drag(b.getElementsByTagName('div')[0],this.win).start(b)}}else{var c=this;var i=b.offsetWidth;var d=setInterval(function(){c.point.x=(c.canvas.width-b.offsetWidth)/2+document.documentElement.scrollLeft;c.point.y=(c.canvas.height-b.offsetHeight)/2+document.documentElement.scrollTop;b.style.left=c.point.x+'px';b.style.top=c.point.y+'px';if(i!=b.offsetWidth){clearInterval(d);if(c.title&&c.drag){new drag(b.getElementsByTagName('div')[0],c.win).start(b)}}},1)}}}simpleDialog.prototype._initialize=function(){if(this._inited){return false}var a=this;var b=this.doc;var c=b.createElement('div');c.id='panel_'+a.id;c.className=a.style;b.body.appendChild(c);var d=b.createElement('div');d.className='bglayer';d.style.cssText='z-index:999;position:absolute;top:0;left:0;width:'+a.canvas.width+'px;height:'+a.canvas.maxHeight+'px;';c.appendChild(d);d=b.createElement("DIV");d.className='box';d.style.cssText='z-index:1000;position:absolute;left:'+(a.point.x)+"px;top:"+(a.point.y)+'px;';c.appendChild(d);if(a.title){var e=b.createElement("div");e.className='title';var f='<span class="left corner" style="position:absolute;left:0;top:0">&nbsp;</span><span class="txt">'+a.title;if(!this.canNotClose){f+='<span class="close" onclick="window[\'dialog_'+this.id+'\'].close()" style="position:absolute;right:5px;top:0;text-decoration:none;font-family:Verdana;cursor:pointer" title="关闭窗口"><span>X</span></span>'}f+=' </span><span class="right corner" style="position:absolute;right:0;top:0">&nbsp;</span>';e.innerHTML=f;d.appendChild(e);this.win['dialog_'+this.id]=this}var g=b.createElement("DIV");g.className='content boxcontent';g.id='boxcontent_'+this.id;d.appendChild(g);if(a.title){var h=b.createElement("div");h.className='bottom';h.style.cssText="position:relative;";h.innerHTML='<span class="left corner" style="position:absolute;left:0;top:0">&nbsp;</span><span class="txt">&nbsp;</span><span class="right corner" style="position:absolute;right:0;top:0">&nbsp;</span>';d.appendChild(h)}this._inited=true};simpleDialog.prototype.getPanel=function(){return this.doc.getElementById('panel_'+this.id)};simpleDialog.prototype.async=function(a,b,c,d,e){this._initialize();var f=this.doc.getElementById('boxcontent_'+this.id);if(d){d(f)}var g=jr.xhr;var h=this;if(!b||b.toLowerCase()=="get"){g.get(a,function(x){jr.loadHTML(f,x);h.fixBoxPosition(true);if(e)e(x)})}else{g.post(a,c,function(x){jr.loadHTML(f,x);h.fixBoxPosition(true);if(e)e(x)})}};simpleDialog.prototype.open=function(a,b,c,d){this._initialize();var e=this.doc.getElementById('boxcontent_'+this.id);e.innerHTML+="<iframe frameborder='0' scrolling='"+(d||'auto')+"' src='"+a+"' width='"+(b||'100%')+"' style='padding:0' height='"+(c||'100%')+"'></iframe>";e.style.width=Math.max(e.scrollWidth,b)+'px';e.style.height=Math.max(e.scrollHeight,c)+'px';this.fixBoxPosition()};simpleDialog.prototype.write=function(a){this._initialize();var b=this.doc.getElementById('boxcontent_'+this.id);if(!this.title){b.innerHTML=a}else{var c=b.getElementsByTagName('DIV');for(var i=1;i<c.length;i++){b.removeChild(c[i])}b.innerHTML+=a}this.fixBoxPosition()};simpleDialog.prototype.getFrameWindow=function(){var a=this.getPanel().getElementsByTagName('IFRAME');if(a.length>0){return a[0].contentWindow}return null};simpleDialog.prototype.close=function(b){if(this.onclose!=null&&this.onclose()==false){return false}var c=0;var d=this.getPanel();var e=(function(a){return function(){a.document.body.removeChild(d);if(b)b()}}(this.win));try{delete this.win['dialog_'+this.id]}catch(ex){this.win['dialog_'+this.id]=null}e();this._inited=false};function drag(a,b){this.elem=a;this.win=b}drag.prototype.regist=function(a,b,c,d){var o=this.elem;a=a?a:o;var f,sy;var g=this.win==null?g:this.win.document;o.style.cursor=b||"move";var h=c||function(e){e=e||event;window.getSelection?window.getSelection().removeAllRanges():g.selection.empty();if(e.preventDefault)e.preventDefault();with(a.style){position="absolute";left=e.clientX-f+"px";top=e.clientY-sy+"px"}};jr.event.add(o,"mousedown",function(e){e=e||event;if(e.button==1||e.button==0){f=e.clientX-a.offsetLeft;sy=e.clientY-a.offsetTop;jr.event.add(g,'mousemove',h,false);jr.event.add(g,'mouseup',i,false)}},false);var i=function(){jr.event.remove(g,'mousemove',h,false);jr.event.remove(g,'mouseup',i,false);if(d&&d instanceof Function)d()}};drag.prototype.custom=function(a,b,c,d){return this.regist(a,b,c,d)};drag.prototype.start=function(a){this.regist(a,null,null,null)};var SimpleDialog={create:function(a){return new simpleDialog(a)},create2:function(a,b,c,d,e){return new simpleDialog({title:a,drag:b||false,cross:c||false,style:e,onclose:d})},getDialog:function(){var b=null;var c=/^dialog_/i;var e=window;var f=function(a){var d=null;for(var i in a){if(c.test(i)&&a[i]!=null){d=a[i];break}}return d};do{b=f(e);if(b==null){e=e.parent;b=f(e)}if(b){break}}while(e.parent!=e);return b},close:function(){var d=this.getDialog();if(d)d.close()},ALERT_MSG_TPL:'<div class="ui-alert-message"><span class="alert-icon alert-icon-{icon}"></span>{msg}</div>',ALERT_BTN_TPL:'<input type="button" tag="{tag}" value="{text}"/>',ALERT_ALL_TITLE:'提示',ALERT_BTN_OK_TEXT:'确定',ALERT_BTN_CANCEL_TEXT:'取消',customAlert:function(p){var b=this.ALERT_ALL_TITLE+'-'+(p.title||'');b=b.replace(/^-|-$/g,'');var d=this.create({title:b,drag:p.drag||true,cross:p.cross||true,canClose:false});d.write(jr.template(this.ALERT_MSG_TPL,{msg:p.message,icon:p.icon}));var c='';for(var i=0;i<p.buttons.length;i++){var e=p.buttons[i];c+=jr.template(this.ALERT_BTN_TPL,{tag:e.tag,text:e.text})}var f=Math.floor(Math.random()*10000);d.write('<div class="ui-alert-control" id="ui-alert-control-'+f+'">'+c+'</div>');var g=jr.$('ui-alert-control-'+f).getElementsByTagName('INPUT');for(var i=0;i<g.length;i++){g[i].onclick=(function(d,p){return function(){var a=this.getAttribute('tag');if(p.click&&p.click instanceof Function){if(p.click(a,d)){d.close()}}else{d.close()}}})(d,p)}return d},alert:function(a,b,c,d){return this.customAlert({icon:c,message:a,buttons:[{tag:'ok',text:d||this.ALERT_BTN_OK_TEXT},],click:function(){if(b instanceof Function)b();return true}})},confirm:function(b,c,d){var e=this.ALERT_BTN_OK_TEXT;var f=this.ALERT_BTN_CANCEL_TEXT;if(d instanceof Array&&d.length===2){e=d[0];f=d[1]}return this.customAlert({icon:'confirm',message:b,buttons:[{tag:'ok',text:e},{tag:'cancel',text:f}],click:function(a){if(c instanceof Function){c(a!='cancel')}return true}})}};(function(j){j.extend({dialog:window.SimpleDialog,drag:function(a,b){return new drag(a,b)}})}(jr));
var hexcase=0;var b64pad="";var chrsz=8;function hex_sha1(s){return binb2hex(core_sha1(str2binb(s),s.length*chrsz))}function b64_sha1(s){return binb2b64(core_sha1(str2binb(s),s.length*chrsz))}function str_sha1(s){return binb2str(core_sha1(str2binb(s),s.length*chrsz))}function hex_hmac_sha1(a,b){return binb2hex(core_hmac_sha1(a,b))}function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))}function str_hmac_sha1(a,b){return binb2str(core_hmac_sha1(a,b))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(x,f){x[f>>5]|=0x80<<(24-f%32);x[((f+64>>9)<<4)+15]=f;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var g=a;var h=b;var k=c;var l=d;var m=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=safe_add(a,g);b=safe_add(b,h);c=safe_add(c,k);d=safe_add(d,l);e=safe_add(e,m)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return(b&c)|((~b)&d);if(t<40)return b^c^d;if(t<60)return(b&c)|(b&d)|(c&d);return b^c^d}function sha1_kt(t){return(t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514}function core_hmac_sha1(a,b){var c=str2binb(a);if(c.length>16)c=core_sha1(c,a.length*chrsz);var d=Array(16),opad=Array(16);for(var i=0;i<16;i++){d[i]=c[i]^0x36363636;opad[i]=c[i]^0x5C5C5C5C}var e=core_sha1(d.concat(str2binb(b)),512+b.length*chrsz);return core_sha1(opad.concat(e),512+160)}function safe_add(x,y){var a=(x&0xFFFF)+(y&0xFFFF);var b=(x>>16)+(y>>16)+(a>>16);return(b<<16)|(a&0xFFFF)}function rol(a,b){return(a<<b)|(a>>>(32-b))}function str2binb(a){var b=Array();var c=(1<<chrsz)-1;for(var i=0;i<a.length*chrsz;i+=chrsz)b[i>>5]|=(a.charCodeAt(i/chrsz)&c)<<(24-i%32);return b}function binb2str(a){var b="";var c=(1<<chrsz)-1;for(var i=0;i<a.length*32;i+=chrsz)b+=String.fromCharCode((a[i>>5]>>>(24-i%32))&c);return b}function binb2hex(a){var b=hexcase?"0123456789ABCDEF":"0123456789abcdef";var c="";for(var i=0;i<a.length*4;i++){c+=b.charAt((a[i>>2]>>((3-i%4)*8+4))&0xF)+b.charAt((a[i>>2]>>((3-i%4)*8))&0xF)}return c}function binb2b64(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c="";for(var i=0;i<a.length*4;i+=3){var d=(((a[i>>2]>>8*(3-i%4))&0xFF)<<16)|(((a[i+1>>2]>>8*(3-(i+1)%4))&0xFF)<<8)|((a[i+2>>2]>>8*(3-(i+2)%4))&0xFF);for(var j=0;j<4;j++){if(i*8+j*6>a.length*32)c+=b64pad;else c+=b.charAt((d>>6*(3-j))&0x3F)}}return c}

function unix2str(v){
    if(typeof(v)=='string'){
        v = parseInt(v);
    }
    return new Date(v*1000).format("yyyy-MM-dd HH:mm:ss");
}
var sha1Offset = "@k3f.net";
function sha1(s){
    return hex_sha1(hex_sha1(s+sha1Offset));
}